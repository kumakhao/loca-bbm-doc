\chapter{Versuche in der Simulation}
\label{chap:versuche}
Die Versuche in diesem Kapitel sollen helfen das entwickelte Verfahren zu bewerten. Es wird einen Versuch geben, um das Messmodell des Partikel-Filters zu untersuchen. Danach wird anhand von verschiedenen Fahrkurven das Verhalten bei unterschiedlichen Bildaufnahmefrequenzen betrachtet, sowie der Einfluss von Personen auf der Bühne beurteilt.

\section{Versuche zur Genauigkeit des Messmodells}
\label{sec:VersucheModell}
In einer ersten Versuchsreihe, soll die Genauigkeit des im Partikelfilter verwendeten Messmodells untersucht werden. Dafür soll zu einem gegebenen Bild möglichst der gesamte Zustandsraum mit dem in Kapitel \ref{subsec:messmodell} beschriebenen Verfahren bewertet werden. Die Anzahl der Punkte im Zustandsraum, die einen hohen Score erhalten, lässt darauf schließen wie genau die Zuordnung zwischen Bild und Pose funktioniert. Im ersten Durchlauf soll zunächst grob der gesamte Raum abgesucht werden. Er soll einen Überblick geben, wo starke Antworten liegen, die dann in weiteren Durchläufen genauer abgetastet werden können.

\begin{figure}[p]
    \centering
    \vspace{-40pt}
    \input{chapter3/messmodell/full_6x6_5cm_005Deg.tex}
    \vspace{-20pt}
    \input{chapter3/messmodell/position_variance_on_picture.tex}
    \caption[Antwort des Messmodells im Zustandsraum auf ein gegebenes Bild]{Antwort des Messmodells zu einem Bild an der rot markierten Position oben: 5cm Raster 3° Schritte unten: 1cm Raster 0.3° Schritte}
    \label{fig:messmodellPos}
\end{figure}

Für die Versuchsreihe wird der Zustandsraum zunächst grob in 5~cm Rasterschritten durchsucht. Dabei wird die Orientierung in 0,05 Rad (2,86°) Schritte Aufgeteilt. In drei Schleifen wird so der Zustandsraum durchlaufen. Als Messung wurde ein am Ursprung (x = 0, y = 0, psi = 0) aufgenommenes Bild verwendet. Für die Darstellung in Abbildung \ref{fig:messmodellPos} oben, wurden Höhenlinien der Messantwort geplottet. Dabei wurde jeweils nur die stärkste Antwort an einer Position über alle Winkel gewählt. Bei einem Zweiten Durchlauf wurde die Positionsrasterung auf 1~cm Schritte, und die Winkelschritte auf 0,005 Rad (0.28°) verkleinert. Zu sehen ist dies auf Abbildung \ref{fig:messmodellPos} unten. Um den Einfluss des Winkels darzustellen wurde in Abbildung \ref{fig:messmodellAngle} die Antwort entlang einer Linie mit $x=0.0$ geplottet. 

In Abbildung \ref{fig:messmodellPos} oben ist der Zustandsraum der Position dargestellt. Die Orientierung konnte in dieser Abbildung nicht gezeigt werden. Die Lichtwände sind zur Orientierung als schwarze Balken eingezeichnet worden. Der rote Kreis in der Mitte zeigt die wahre Pose des Roboters von der das verwendete Bild stammt. Eine Antwort des Messmodells ist nur um die wahre Position zu sehen, auf dem Rest der Bühne gab es keine signifikante Antwort. Auf dem Bild darunter sieht man einen Vergrößerten Ausschnitt um die wahre Position. Hier fällt auf, dass die Häufung sich leicht schräg liegt. Dies liegt vermutlich daran, dass die Lichtwand auf der das Muster abgebildet ist, nicht zentral vor dem Roboter steht, sondern in Y-Richtung verschoben ist. Die Häufung der Antworten streut vor allem entlang der Y-Achse. Also bei einer seitlichen Verschiebung des Roboters. Dabei sind innerhalb von $\pm 30\ cm$ immer noch Scores oberhalb von 0,8 möglich. Entlang der X-Achse ist eine Streuung zwischen $+15$ und $-10$~cm zu erkennen. Durch die Höhenlinien sieht man, dass entlang der x-Achse der Score eine große Steigung hat. Dies führt zu einer relativ scharfen Kante in der in dieser Richtung. Auf der y-Achse dagegen, ist die Steigung schwäche und bildet keine so scharfe Kante. 
Aus Abbildung \ref{fig:messmodellAngle} lässt sich entnehmen, dass bei einer Verschiebung entlang der Y-Achse eine Drehung des Roboters nötig ist, um eine Pose zu erhalten die einen guten Score erhält.
\begin{figure}[h]
    \centering
    \input{chapter3/messmodell/pTOyANDangle_1cm_0005Deg_xIS0.tex}
    \caption{Antwort des Messmodells bei x=0.0}
    \label{fig:messmodellAngle}
\end{figure}

\section{Verwendete Fahrkurven}
\label{sec:Fahrkurven}
Es sind vier verschiedene Fahrkurven für die folgenden zwei Versuche verwendet worden. An dieser Stelle soll kurz auf Besonderheiten hingewiesen werden, die für diese Kurven beobachtet wurden. Für alle Kurven gilt, dass sie in der Mitte der Bühne beginnen, und die Lokalisation mit der Startposition initialisiert ist. Das bedeutet, dass die Versuche sich auf das Pose Tracking der Lokalisation beziehen. Auf den Abbildungen \ref{fig:FahrLoopsAntiTop} und \ref{fig:FahrSchlangenTop} sind die Lichtwände zur Orientierung als Schwarze Rechtecke in die Diagramme eingezeichnet worden. Bei den Simulationen für diese Fahrkurven wurde alle 1500~ms Bilder der Kamera ausgewertet. Die Blauen Ellipsen sind die $3\sigma$ Vertrauensbereiche um die geschätzte Position des Roboters. Sie wurden für einzelne Stichproben eingezeichnet.

\begin{description}
\item[Loop Anticlockwise] Ist eine Fahrt entlang der äußeren Kanten der Bühne, dabei fährt der Roboter gegen den Uhrzeigersinn. Die Sichtbarkeit der Lichtwände ist bei dieser Richtung etwas schlechter, da die Wände nicht auf der Ganzen Länge der Bühne stehen, sondern immer versetzt. Der Roboter fährt immer auf die offene Stelle einer Bühnenseite zu. Es müssten weniger Bit-Musterpunkte im Bild zu sehen sein, als bei der Fahrt im Uhrzeigersinn. Aber genug um einen Score zu bilden. Zu sehen auf Abbildung~\ref{fig:FahrLoopsAntiTop} oben auf Seite~\pageref{fig:FahrLoopsAntiTop}. Es ist zu erkennen, dass auch entlang der offenen Seite die Unsicherheit groß bleibt. Obwohl auf eine Der Lichtwände zu gefahren wird. Dies liegt vermutlich an der Versetzt aufgestellten Wand. Der Roboter fährt hier auf ein offenes Stück zu und die Mess-Updates reichen nicht um die Position genauer eingrenzen zu können.
\item[Loop Clockwise] Diese Fahrt ist der ersten sehr ähnlich, bis auf die Fahrtrichtung. Diese ist im Uhrzeigersinn. Der Roboter hat die meiste Zeit mindestens eine Lichtwand im Bild. Nur wenn er auf die Offene Seite zu fährt erhält er kein auswertbares Messupdate. Zu sehen auf Abbildung~\ref{fig:FahrLoopsAntiTop} unten auf Seite~\pageref{fig:FahrLoopsAntiTop}. Die Unsicherheit der Position nimmt mit auf dem Stück zur offenen Seite hin deutlich zu. Aber sobald wieder eine Lichtwand ins Bild kommt, nimmt sie wieder ab.
\end{description}
\begin{figure}[p]
    \centering
    \vspace{-30pt}
    \input{chapter3/fahrkurven/Loop_Anticlockwise_1500.tex}
    \vspace{-10pt}
    \input{chapter3/fahrkurven/Loop_Clockwise_1500.tex}
    \caption{Fahrkurven oben gegen, und unten im Uhrzeigersinn}
    \label{fig:FahrLoopsAntiTop}
\end{figure}
\vspace{80pt}
\begin{description}
\item[Schlangenlinien] Bei dieser Fahrt fährt der Roboter mehrere male zwischen der Seite ohne Lichtwand und  der ihr gegenüber liegenden Lichtwand hin und her. Dabei fährt er in Schlangenlinien die Bühne ab. In dieser Fahrkurve sind besonders viele scharfe Kurve enthalten. Außerdem wird immer wieder auf die offene Seite zu gefahren, so dass es zeitweise keine auswertbaren Bilder gibt. Zu sehen auf Abbildung~\ref{fig:FahrSchlangenTop} oben auf Seite~\pageref{fig:FahrSchlangenTop}. Besonders stark wird die Unsicherheit wenn der Roboter oben links im Diagramm dicht an der Lichtwand entlang und auf die offene Seite zu fährt. Außerdem ist gut zu sehen, wie die Unsicherheit größer wird, wenn der Roboter in negativer x-Richtung auf die offene Seite zu fährt und wieder kleiner wird, wenn er in positiver x-Richtung auf die Lichtwand zu fährt.
\item[Ellipse] Eine schräge Ellipse die um den Mittelpunkt liegt. Dabei fährt der Roboter mal auf zwei Lichtwände zu und mal auf die Ecke der Bühne in der  keine Lichtwände stehe. Während er auf die offene Seite zu fährt, wird er zeitweise keine Lichtwand sehen um einen verwertbare Messung zu erhalten. Zu sehen auf Abbildung~\ref{fig:FahrSchlangenTop} unten auf Seite~\pageref{fig:FahrSchlangenTop}. Entsprechend verhält sich die Unsicherheit auf diesem Abschnitt. Sie wird größer, bis die Kamera wieder ein Bild mit Lichtwand liefert. Auf der Fahrt auf die Lichtwände zu bleibt die Unsicherheit klein.
\end{description}

\section{Versuche zur Bildaufnahmefrequenz}
\label{sec:versucheFrequenz}
Es soll untersucht werden in welchen Intervallen Bilder benötigt werden. Wie stark der Einfluss der Fahrkurve darauf ist, und welche Faktoren die Bildaufnahmefrequenz beeinflussen können. Dazu werden die vier beschriebenen Fahrkurven eingesetzt. Sie werden in einem Simulationslauf dreimal abgefahren. Dabei wird der Abstand zwischen der wahren und der vom Filter geschätzten Position des Roboters errechnet und über die Simulationsdauer ein Mittelwert $\hat{d}$ bestimmt.
\begin{equation}
\hat{d}=\frac{1}{n}\sum\limits_{i=0}^n \sqrt{(x_i-xtrue_i)^2+(y_i-ytrue_i)^2}
\end{equation}
Um zusätzlich noch ein Maß für die Genauigkeit der geschätzten Position zu haben, wird der Mittelwert der großen Achse der Unsicherheits-Ellipsen gebildet:
\begin{equation}
\hat{a}=\frac{1}{n}\sum\limits_{i=0}^n a_i
\end{equation} 

\begin{figure}[hp]
    \centering
    \vspace{-30pt}
    \input{chapter3/fahrkurven/serpentinen_1500.tex}
    \vspace{-10pt}
    \input{chapter3/fahrkurven/Oval_1500.tex}
    \caption{Fahrkurven oben Schlangenlinien, unten schräge Ellipse}
    \label{fig:FahrSchlangenTop}
\end{figure}

Jeder Simulationsdurchlauf arbeitet mit zufälligen systematischen Messabweichungen, darum werden 15 Simulationsdurchläufe bei gleichen Einstellungen durchgeführt und über deren Ergebnisse gemittelt. Es wurden vier verschiedene Schritte für die Zeit zwischen zwei Bildern festgelegt: 500, 1000, 2000 und 4000~$ms$. Für jeden dieser Schritte wurde jede Fahrkurve damit 15 mal simuliert. 

\begin{figure}[h]
	\centering
	\input{chapter3/picFrequency/frequencyPlot.tex}
	\caption[Mittlerer Abstand über Bildaufnahmefrequenz]{Gemittelter Abstand von der Fahrkurve über verschiedene Bildaufnahmefrequenzen mit vier verschiedenen Fahrkurven.}
	\label{fig:frequencyPlot}
\end{figure}
Die Ergebnisse sind in Abbildung \ref{fig:frequencyPlot} und \ref{fig:frequencyPlot_var} zu sehen. Für alle vier Fahrkurven lässt sich beobachten, dass bei sinkender Bildaufnahmefrequenz sich ein Anstieg des Mittleren Abstandes zur tatsächlich gefahrenen Trajektorie ergibt. Für die Fahrkurven \emph{Ellipse}, \emph{Loop~Clockwise} und \emph{Loop~Anticlockwise} ist der Anstieg zwischen 500 und 2000~$ms$ in etwa linear und macht ab 4000~$ms$ einen Sprung. Für \emph{}
\begin{figure}[h]
	\centering
	\input{chapter3/picFrequency/frequencyPlot_var.tex}
	\caption{Gemittelter langer Durchmesser der Unsicherheits-Ellipse über verschiedene Bildaufnahmefrequenzen mit vier verschiedenen Fahrkurven.}
	\label{fig:frequencyPlot_var}
\end{figure}
\section{Versuche zum Einfluss von Menschen auf der Bühne}
\label{sec:VersucheCroud}

\begin{wrapfigure}{o}{0.5\textwidth}
  	\center
    \includegraphics[width=0.45\textwidth]{chapter3/maxCrowd.png}
    \caption{Mögliche Positionen von Personen}
    \label{fig:maxCrowd}
\end{wrapfigure}
Hier sollen Versuche zeigen, wie stark Menschen auf der Bühne die Lokalisation mit dem hier vorgestellten Verfahren stören. Dabei geht es im wesentlichen darum, dass Menschen im Bild stehen und so die Bit-Muster ganz oder teilweise verdecken. Dazu werden ebenfalls die in Abschnitt \ref{sec:Fahrkurven} beschriebenen Fahrkurven verwendet. Genau wie bei den Versuchen zur Bildaufnahmefrequenz wird auch hier der mittlere Abstand zur wahren Roboterposition verwendet. Die Durchführung ist die gleiche wie zuvor, nur dass als Zeit zwischen zwei Bildern auf 1500~$ms$ eingestellt wurde. Statt Bildaufnahmefrequenz wird nun die Anzahl der Personen auf der Bühne von 3 auf 9, 15 und 21 erhöht.

Für die Positionen der Personen auf der Bühne gibt es 23 festgelegte Stellen. Aus diesen wird bei jedem Simulationslauf zufällig die benötigte Anzahl gezogen. Auf Abbildung \ref{fig:maxCrowd} sieht man die möglichen Positionen der Personen. Wie in Abschnitt \ref{sec:dieSzene} beschrieben sind die Personen 1800~mm hoch und 400~mm breit. Die Vermutung wäre, je mehr Personen sich auf der Bühne befinden, umso häufiger kommt es vor, das sie im Bild stehen und das Bit-Muster teilweise oder ganz verdecken. Also müsste bei einer hohen Personendichte der mittlere Abstand von der wahren Position größer werden. 
\begin{figure}[h]
	\centering
	\input{chapter3/croudEffect/croudEffect.tex}
	\caption{toller text}
	\label{fig:croudEffectPlot}
\end{figure}