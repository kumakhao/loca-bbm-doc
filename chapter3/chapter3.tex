\chapter{Versuche in der Simulation}
\label{chap:versuche}
Die Versuche in diesem Kapitel sollen helfen das entwickelte Verfahren zu bewerten. Zunächst wird eine Versuch beschrieben, in dem das Messmodell des Partikel-Filters untersucht wurde. Danach wird anhand von verschiedenen Fahrkurven das Verhalten bei unterschiedlichen Bildaufnahmefrequenzen betrachtet, sowie der Einfluss von Personen auf der Bühne beurteilt.

Wenn nicht anders angegeben, werden folgende Einstellungen für Simulation und Lokalisation verwendet:

\begin{tabular}{cc}
	\begin{minipage}{0.45\textwidth}
		\begin{description}
		\item[test1] hallo
		\item[test3] moin
		\end{description}
	\end{minipage} & 
	\begin{minipage}{0.45\textwidth}
		\begin{description}
		\item[test2] hallo2
		\item[test4] moin4
		\end{description}
	\end{minipage}
\end{tabular} 
\section{Versuche zur Genauigkeit des Messmodells}
\label{sec:VersucheModell}
In einer ersten Versuchsreihe, soll die Genauigkeit des im Partikelfilter verwendeten Messmodells untersucht werden. Dafür soll zu einem gegebenen Bild möglichst der gesamte Zustandsraum mit dem in Kapitel \ref{subsec:messmodell} beschriebenen Verfahren bewertet werden. Die Anzahl der Punkte im Zustandsraum, die einen hohen Score erhalten, lässt darauf schließen wie genau die Zuordnung zwischen Bild und Pose funktioniert. Im ersten Durchlauf soll zunächst grob der gesamte Raum abgesucht werden. Er soll einen Überblick geben, wo Antworten liegen, die dann in weiteren Durchläufen genauer abgetastet werden können.

\begin{figure}[p]
    \centering
    \vspace{-40pt}
    \input{chapter3/messmodell/full_6x6_5cm_005Deg.tex}
    \vspace{-20pt}
    \input{chapter3/messmodell/position_variance_on_picture.tex}
    \caption[Antwort des Messmodells im Zustandsraum auf ein gegebenes Bild]{Antwort des Messmodells zu einem Bild an der rot markierten Position oben: 5\,$cm$ Raster 3° Schritte unten: 1\,$cm$ Raster 0.3° Schritte}
    \label{fig:messmodellPos}
\end{figure}

Für die Versuchsreihe wird der Zustandsraum zunächst grob in 5\,$cm$ Rasterschritten durchsucht. Dabei wird die Orientierung in 0,05 Rad (2,86°) Schritte aufgeteilt. In drei Schleifen wird so der Zustandsraum durchlaufen. Als Messung wurde ein am Ursprung (x = 0, y = 0, psi = 0) aufgenommenes Bild verwendet. Für die Darstellung in Abbildung \ref{fig:messmodellPos} oben, wurden Höhenlinien der Messantwort eingezeichnet. Dabei wurde jeweils nur die stärkste Antwort an einer Position über alle Winkel gewählt. Bei einem Zweiten Durchlauf wurde die Positionsrasterung auf 1\,cm Schritte und die Winkelschritte auf 0,005 Rad (0.28°) verkleinert. Zu sehen ist dies auf Abbildung \ref{fig:messmodellPos} unten. Um den Einfluss des Winkels darzustellen wurde in Abbildung \ref{fig:messmodellAngle} die Antwort entlang einer Linie mit $x=0.0$ geplottet. 

In Abbildung \ref{fig:messmodellPos} oben ist der Zustandsraum der Position dargestellt. Die Orientierung konnte in dieser Abbildung nicht gezeigt werden. Die Lichtwände wurden als schwarze Balken kenntlich gemacht. Der rote Kreis zeigt die Pose des Roboters als das Bild aufgenommen wurde. Eine Antwort des Messmodells ist nur um die diese Position zu sehen, in dem Rest des Zustandsraumes (Bühne) gab es keine signifikante Antwort. Auf dem Bild darunter sieht man einen Vergrößerten Ausschnitt um die Roboterposition. Hier fällt auf, dass die Häufung leicht schräg liegt. Der Grund dafür ist vermutlich, dass die Lichtwand auf der das Muster abgebildet ist, nicht zentral vor dem Roboter steht, sondern in Y-Richtung verschoben ist. Die Häufung der Antworten streut vor allem entlang der Y-Achse, dies entspricht einer seitlichen Verschiebung des Roboters entlang dieser Achse bei gleichzeitiger Drehung. Dabei sind innerhalb von $\pm 30$\,$cm$ immer noch Scores größer als 0,8 möglich. Entlang der X-Achse ist eine Streuung zwischen $+15$ und $-10$\,cm zu erkennen. Durch die Höhenlinien ist zu erkennen, dass entlang der x-Achse der Score eine große Steigung hat. Dies führt zu einer relativ scharfen Kante in dieser Richtung. Auf der y-Achse dagegen, ist die Steigung schwächer, dadurch bildet sich keine scharfe Kante. 
Aus Abbildung \ref{fig:messmodellAngle} lässt sich entnehmen, dass bei einer Verschiebung entlang der Y-Achse eine Drehung des Roboters nötig ist, um eine Pose zu erhalten die einen guten Score erhält.
\begin{figure}[h]
    \centering
    \input{chapter3/messmodell/pTOyANDangle_1cm_0005Deg_xIS0.tex}
    \caption{Antwort des Messmodells bei x=0.0}
    \label{fig:messmodellAngle}
\end{figure}

\section{Verwendete Fahrkurven}
\label{sec:Fahrkurven}
Es sind vier verschiedene Fahrkurven für die folgenden zwei Versuche verwendet worden. An dieser Stelle soll kurz auf Besonderheiten hingewiesen werden, die für diese Kurven beobachtet wurden. Für alle Kurven gilt, dass sie in der Mitte der Bühne beginnen, und die Lokalisation mit der Startposition initialisiert ist. Die Versuche beziehen sich somit nur auf das Pose Tracking der Lokalisation. Auf den Abbildungen \ref{fig:FahrLoopsAntiTop} und \ref{fig:FahrSchlangenTop} sind die Lichtwände zur Orientierung als schwarze Rechtecke in die Diagramme eingezeichnet worden. Bei den Simulationen für diese Fahrkurven wurden alle 1500\,ms Bilder der Kamera ausgewertet. Die blauen Ellipsen sind die $3\sigma$ Vertrauensbereiche um die geschätzte Position des Roboters. Sie wurden für einzelne Stichproben eingezeichnet.

\paragraph*{Loop Anticlockwise}
\label{para:LoopAnti}
Ist eine Fahrt entlang der äußeren Kanten der Bühne, dabei fährt der Roboter gegen den Uhrzeigersinn.
Die Lichtwände stehen nicht auf der Ganzen Länge der Bühne, sondern immer versetzt. Dies führt bei dieser Fahrtrichtung dazu, dass die Lichtwände seltener im Bild sichtbar sind. Es müssten weniger Bit-Musterpunkte im Bild zu sehen sein, als bei der Fahrt im Uhrzeigersinn. Aber genug um einen Score zu bilden. Zu sehen auf Abbildung~\ref{fig:FahrLoopsAntiTop} oben auf Seite~\pageref{fig:FahrLoopsAntiTop}. Es ist zu erkennen, dass auch entlang der offenen Seite die Unsicherheit groß bleibt, obwohl auf eine Lichtwände zu gefahren wird. Dies liegt vermutlich an der Versetzt aufgestellten Wand. Der Roboter fährt hier auf ein offenes Stück zu und die Mess-Updates reichen nicht um die Position genauer eingrenzen zu können.

\begin{figure}[p]
    \centering
    \vspace{-30pt}
    \input{chapter3/fahrkurven/Loop_Anticlockwise_1500.tex}
    \vspace{-10pt}
    \input{chapter3/fahrkurven/Loop_Clockwise_1500.tex}
    \caption{Fahrkurven oben Loop~Anticlockwise, und unten Loop~Clockwise}
    \label{fig:FahrLoopsAntiTop}
\end{figure}

\paragraph*{Loop Clockwise}
Fährt die gleiche Strecke von \textbf{Loop~Anticlockwise} entlang, nur im Uhrzeigersinn. Die Kamera des Roboters ist die meiste Zeit auf mindestens eine Lichtwand gerichtet. Nur wenn er auf die offene Seite zu fährt erhält er kein auswertbares Messupdate. Zu sehen auf Abbildung~\ref{fig:FahrLoopsAntiTop} unten auf Seite~\pageref{fig:FahrLoopsAntiTop}. Die Unsicherheit der Position nimmt auf dem Stück zur offenen Seite hin deutlich zu, sobald wieder eine Lichtwand von der Kamera erfasst wird, nimmt sie wieder ab.

\paragraph*{Schlangenlinien}
Bei dieser Fahrt fährt der Roboter mehrere male zwischen der Seite ohne Lichtwand und  der ihr gegenüber liegenden Lichtwand hin und her. Dabei fährt er in Schlangenlinien die Bühne ab. In dieser Fahrkurve sind besonders viele scharfe Kurve enthalten. Des weiteren wird immer wieder auf die offene Seite zu gefahren, so dass es zeitweise keine auswertbaren Bilder gibt. Zu sehen auf Abbildung~\ref{fig:FahrSchlangenTop} oben auf Seite~\pageref{fig:FahrSchlangenTop}. Besonders stark wird die Unsicherheit wenn der Roboter oben links im Diagramm dicht an der Lichtwand entlang und auf die offene Seite zu fährt. Es ist außerdem gut zu erkennen, wie die Unsicherheit größer wird, wenn der Roboter in negativer x-Richtung auf die offene Seite zu fährt und wieder kleiner wird, wenn er in positiver x-Richtung auf die Lichtwand zu fährt.

\paragraph*{Ellipse}
Eine schräge Ellipse die um den Mittelpunkt liegt. Dabei fährt der Roboter etwa die Hälfte der Strecke auf zwei Lichtwände zu und die andere Hälfte auf die Ecke der Bühne in der  keine Lichtwände stehen. Während er auf die offene Seite zu fährt, sieht er zeitweise keine Lichtwand um einen verwertbare Messung zu erhalten. Zu sehen auf Abbildung~\ref{fig:FahrSchlangenTop} unten auf Seite~\pageref{fig:FahrSchlangenTop}. Entsprechend verhält sich die Unsicherheit auf diesem Abschnitt. Sie wird größer, bis wieder eine Lichtwand in das Gesichtsfeld der Kamera kommt. Auf der Fahrt auf die Lichtwände zu bleibt die Unsicherheit klein.

\begin{figure}[hp]
    \centering
    \vspace{-30pt}
    \input{chapter3/fahrkurven/serpentinen_1500.tex}
    \vspace{-10pt}
    \input{chapter3/fahrkurven/Oval_1500.tex}
    \caption{Fahrkurven oben Schlangenlinien, unten schräge Ellipse}
    \label{fig:FahrSchlangenTop}
\end{figure}

\section{Versuche zur Bildaufnahmefrequenz}
\label{sec:versucheFrequenz}
Es soll untersucht werden in welchen Intervallen Bilder benötigt werden, wie stark der Einfluss der Fahrkurve darauf ist, und welche Faktoren die benötigte Bildaufnahmefrequenz beeinflussen können. Dazu werden die vier beschriebenen Fahrkurven eingesetzt. Sie werden in einem Simulationslauf dreimal abgefahren. Bei diesem Vorgang wird der Abstand zwischen der wahren und der vom Filter geschätzten Position des Roboters errechnet und über die Simulationsdauer ein Mittelwert $\hat{d}$ bestimmt.
\begin{equation}
\hat{d}=\frac{1}{n}\sum\limits_{i=0}^n \sqrt{(x_i-xtrue_i)^2+(y_i-ytrue_i)^2}
\end{equation}

Jeder Simulationsdurchlauf arbeitet mit zufälligen systematischen Messabweichungen. Aus diesem Grund werden 15 Simulationsdurchläufe bei gleichen Einstellungen durchgeführt und über deren Ergebnisse gemittelt. Es wurden vier verschiedene Perioden für die Zeit zwischen zwei Bildern festgelegt: 500, 1000, 2000 und 4000\,$ms$. Für jeden dieser Schritte wurde jede Fahrkurve damit 15 mal simuliert. 

\subsection*{Ergebnisbeschreibung Bildaufnahmefrequenz}
Die Ergebnisse sind in Abbildung \ref{fig:frequencyPlot} zu sehen. Für alle vier Fahrkurven lässt sich beobachten, dass sich bei sinkender Bildaufnahmefrequenz ein Anstieg des mittleren Abstandes zur tatsächlich gefahrenen Trajektorie ergibt. Für die Fahrkurven \textbf{Ellipse} und \textbf{Loop~Anticlockwise} ist der Anstieg zwischen 500 und 2000\,$ms$ in etwa linear und macht ab 4000\,$ms$ einen Sprung. Für die \textbf{Schlangenlinien} ist ein Sprung schon zwischen 1000 und 2000\,$ms$ zu sehen, mit einem weiteren zwischen 2000 und 4000\,$ms$. Bei \textbf{Loop~Clockwise} hingegen ist kein signifikanter Sprung zu erkennen. In Tabelle \ref{tab:laufzeit} werden Beispielhaft die Simulationslaufzeiten für die vier verwendeten Bildaufnahme-Perioden gezeigt. Dabei handelt es sich um nur einen Durchlauf.

\begin{figure}[h]
	\centering
	\input{chapter3/picFrequency/frequencyPlot.tex}
	\caption[Mittlerer Abstand über Bildaufnahmefrequenz]{Gemittelter Abstand von der Fahrkurve über verschiedene Bildaufnahmefrequenzen mit vier verschiedenen Fahrkurven.}
	\label{fig:frequencyPlot}
\end{figure}

\subsection*{Ergebnisauswertung Bildaufnahmefrequenz}
Werden dem Filter nur wenige Bilder pro Minute zur Verfügung gestellt, steigt der mittlere Abstand zur gefahrenen Trajektorie. Der geringe Anstieg zwischen 500 und 1000\,$ms$ lässt sich mit der Tatsache erklären, dass in dem längeren Zeitintervall die Partikel länger auf das Dynamikmodell und dessen Unsicherheiten angewiesen sind. Die Fahrkurve der \textbf{Ellipse} beinhaltet fast keine geraden Abschnitte, sondern beschreibt nahezu eine kontinuierliche Linkskurve. Da die größte Unsicherheit während Drehungen oder Kurvenfahrten entsteht, wie in Abschnitt~\ref{subsec:encoderFehlerInSim}~\textit{\nameref{subsec:encoderFehlerInSim}}  beschrieben, ist dies vermutlich der Grund warum sie bei 500 und 1000\,$ms$ die größte mittlere Abweichung aufweist. Die Fahrkurve in \textbf{Schlangenlinien} hat im Vergleich dazu viele sehr enge Kurven, die zu einer starken Orientierungsänderung führen. Dies müsste größere Unsicherheiten verursachen, als bei der großen kontinuierlichen Kurve der \textbf{Ellipse}. Es befinden sich allerdings zwischen den scharfen Kurven der \textbf{Schlangenlinien} immer Abschnitte einer Geradeausfahrt. Diese geraden Abschnitte können die Unsicherheit in den Kurven kompensieren, wenn entlang dieser ein Mess-Update stattfindet. Damit lässt sich begründen, warum die \textbf{Schlangenlinien} bei 500 und 1000\,$ms$ unter den Werten der \textbf{Ellipse} liegen. Die beiden \textbf{Loop} Fahrkurven haben nur vier Kurven welche mit 90° zwar starke Orientierungsänderungen haben, aber denen langen Geradeausfahrten folgen. Zudem fährt der Roboter auf 3 von 4 dieser geraden Abschnitte direkt auf eine der Lichtwände zu (Bei den \textbf{Schlangenlinien} ist es nur etwa jede zweite). Die Wahrscheinlichkeit ein verwertbares Bild aufzunehmen ist damit größer als bei den ersten beiden Fahrkurven.

Der Sprung zwischen 1000 und 2000\,$ms$ (\textbf{Schlangenlinien}) bzw. 2000 und 4000\,$ms$ (\textbf{Ellipse}, \textbf{Loop~Anitclockwise}) lässt sich damit erklären, dass kein oder zu wenige Mess-Updates auf den geraden Abschnitten durchgeführt werden um die Unsicherheit, welche sich in den Kurven aufbaut, zu kompensieren. Warum \textbf{Loop~Clockwise} keinen solchen Sprung aufweist, während sich bei \textbf{Loop~Anticlockwise} der Wert für den mittleren Abstand zwischen 2000 und 4000\,$ms$ fast verdreifacht lässt sich mit der Fahrtrichtung gegen den Uhrzeigersinn begründen. Diese führt dazu, dass der Roboter stets auf die Lücken zwischen den Lichtwänden zu fährt. Wie im Absatz \textit{\nameref{para:LoopAnti}} oben beschrieben hat dies ungünstige Blickwinkel für die Kamera zu folge.

\subsection*{Erkenntnisse zur Bildaufnahmefrequenz}
Die Bildaufnahmefrequenz ist ein wichtiger Parameter für das vorgestellte Lokalisationsverfahren. Wird sie zu klein eingestellt, so fehlen dem Filter die nötigen Informationen um die geschätzte Pose zu korrigieren. Wird sie hoch eingestellt, führt dies zu viele Mess-Updates, die von dem Filter verarbeitet werden müssen. Dies führt zu größeren Anforderungen an die Hardware auf der dieses Verfahren eingesetzt werden könnte. In Tabelle \ref{tab:laufzeit} wurde zur Veranschaulichung die Laufzeit nur eines Durchlaufs zu den betrachteten Perioden dargestellt. Die absolute Größe hat hier keine Aussagekraft, doch der Vergleich zwischen zwei Laufzeiten liefert einen Eindruck davon wie stark sich die Bildaufnahmefrequenz auf den Gesamtrechenaufwand auswirkt.

Um einen geeigneten Wert angeben zu können ist auch zu beachten, wie die Trajektorie des Roboters auf der Bühne verläuft. Sie hat einen entscheidenden Einfluss auf die Qualität der Lokalisation. Die verwendeten Fahrkurven zeigen, wie unterschiedlich sie auf verschiedene Bildaufnahmefrequenzen reagieren.
\begin{table}[h]
	\center
	\caption{Laufzeit eines Simulationsdurchlaufs bei den verwendeten Perioden}
	\begin{tabular}{|p{25mm}|p{10mm}|p{10mm}|p{10mm}|p{10mm}|}
		\hline 
 		Periode($ms$) & 500 & 1000 & 2000 & 4000 \\ 
		\hline 
		Laufzeit($sec$) & 54,8 & 36,5 & 27,2 & 23,0 \\ 
		\hline 
	\end{tabular}
	\label{tab:laufzeit}
\end{table}

\section{Versuche zum Einfluss von Menschen auf der Bühne}
\label{sec:VersucheCroud}
In diesem Versuch soll untersucht werden, wie stark Menschen auf der Bühne die Lokalisation mit dem hier vorgestellten Verfahren stören. Dabei geht es im wesentlichen darum, dass Menschen im Bild stehen und so die Bit-Muster ganz oder teilweise verdecken. Wie bei den Versuchen zur Bildaufnahmefrequenz wird auch hier der mittlere Abstand zur wahren Roboterposition verwendet. Als Fahrkurven werden ebenfalls die in Abschnitt \ref{sec:Fahrkurven} beschriebenen verwendet. Die Art der Durchführung des Versuches wird nicht verändert. Es wird jedoch anstatt des Zeitintervalls die Anzahl der Personen auf der Bühne geändert (3,9,15,21). Das Zeitintervall für die Bildaufnahme wurde fest auf 1500\,$ms$ eingestellt.

\begin{wrapfigure}{o}{0.5\textwidth}
  	\center
    \includegraphics[width=0.45\textwidth]{chapter3/maxCrowd.png}
    \caption{Mögliche Positionen von Personen}
    \label{fig:maxCrowd}
\end{wrapfigure}
Es gibt 23 festgelegte Positionen für Personen auf der Bühne. Aus diesen wird bei jedem Simulationslauf zufällig die benötigte Anzahl ermittelt. Auf Abbildung~\ref{fig:maxCrowd} sind die möglichen Positionen der Personen zu sehen. Wie in Abschnitt~\ref{sec:dieSzene} beschrieben sind die Personen 1800\,mm hoch und 400\,mm breit. Es ist davon auszugehen, dass je mehr Personen sich auf der Bühne befinden, es umso häufiger vorkommt, dass sie das Bit-Muster teilweise oder ganz verdecken. Bei einer hohen Personendichte sollte demnach der mittlere Abstand von der wahren Position größer werden. 
\begin{figure}[h]
	\centering
	\input{chapter3/croudEffect/croudEffect.tex}
	\caption{toller text}
	\label{fig:croudEffectPlot}
\end{figure}