\chapter{Grundlagen}
\label{chap:grundlagen}

\section{Lokalisation}
\label{sec:lokalisation}
Die Lokalisation ist eines der Grundprobleme das beim Einsatz von mobilen Robotern auftritt.
In \cite[Seite 193]{Thrun2006} wird die sie in drei Teilprobleme zerlegt:
\begin{description}
\item[Position Tracking] bezeichnet den Vorgang, bei dem mit bekannter Ausgangsposition diese mit Hilfe von Sensordaten bei Bewegungen verfolgt werden kann. Dabei spielt das Dynamikmodell des Roboters sowie darin modellierte Unsicherheiten eine wichtige Rolle. Denn bewegt sich der Roboter von einer bekannten Position aus, wird mit dem Dynamikmodell seine neue Position geschätzt. Die Unsicherheiten des Modells erzeugen dabei eine Wahrscheinlichkeitsverteilung um diese neue Position, in der sich die wahre Position befinden sollte. Ohne Messungen von weiteren Sensoren die Rückschlüsse auf die Umgebung erlauben, würde die Positionsschätzung mit der Zeit immer ungenauer. Mit Hilfe eines Messmodells lässt sich beurteilen, ob eine Messung an einer Bestimmten Position wahrscheinlich erscheint, oder nicht. Dadurch lässt sich die Wahrscheinlichkeitsverteilung der Position nach einer Bewegung durch eine Messung wieder eingrenzen. Auf den Bereich, in dem der Messwert des Sensors am Wahrscheinlichsten ist.
\item[Global Localization] ist das finden der Anfangsposition des Roboters unter allen Möglichen Posen die im Szenario vorkommen können. Im Vergleich zum \textit{Position Tracking}, bei dem es genügte die Unsicherheit um die geschätzte neue Pose zu berücksichtigen, umfasst hier der Raum möglicher Posen ein erheblich größeres Volumen. Ein Ansatz wäre alle möglichen Posen mit der selben Wahrscheinlichkeit anzunehmen, und mit den ersten Messungen und dem Messmodell diese einzugrenzen. Auf Bereiche in denen diese Messungen mit hoher Wahrscheinlichkeit auftritt. 
\item[Kidnapped Robot Problem] ist eine verschärfte Variante des \textit{Global Localization} Problems. Dabei geht man davon aus, das sich der Roboter spontan an einem anderen Ort aufhält als vom Roboter angenommen. Nun müsste die Lokalisation des Roboters wieder im gesamten möglichen Raum erfolgen. Nur das der Roboter diesen Zustand nicht feststellen kann. 
\end{description}

\subsection{Übersicht gängiger Verfahren}
\label{subsec:uebersichtVerfahren}
Die meisten Lösungsansätze verwenden im Grunde eine Variante des Bayes-Filters wie z.B. in \cite[Seite 26]{Thrun2006} beschrieben. Abhängig vom Einsatzumfeld und der verwendeten Hardware gibt es aber noch Andere Verfahren.

In \cite{seco2009survey} zum Beispiel werden, neben dem Bayes-Filter, drei weitere genannt: \textit{Geometry-Based Methods}, \textit{Minimization of the cost function} und \textit{Fingerprint Methods} die sich in Gebäuden unter Nutzung von Elektromagnetischen Signale verwenden lassen. Je nach Sensorausstattung werden verschiedene Karten der Umgebung verwendet. Auf die sich der Roboter durch Auswertung von Sensormessungen lokalisieren muss. Dabei gibt es Karten die vorher angefertigt wurden, und dem Roboter bereits zur Verfügung stehen. Und es gibt Karten die der Roboter selbstständig während der Lokalisation erstellen muss. Letzteres wird als \ac{SLAM} Problem bezeichnet zu dem es bereits viele Veröffentlichungen gibt (u.a.) \cite[Seite 309]{Thrun2006}, \cite{Thrun:2002:PFR:2073876.2073937}, \cite[Seite 229]{Hertzberg2012}

Der in Kapitel \ref{chap:einleitung} erwähnte Partikel Filter ist eine Variante des Bayes-Filters. Er ist auch als \ac{MCL} bekannt. Alternativ dazu gibt es zum Beispiel den Kalman Filter, der mit Normalverteilungen die Wahrscheinlichkeiten abbildet. Er ist in seiner Anwendbarkeit auf lineare Probleme beschränkt oder ist auf Linearisierung angewiesen. Dafür ist er aber eines der ältesten Verfahren und damit am besten untersucht. In \cite{HaXInte2012} wird er bei einem Lokalisationsproblem verwendet. Außerdem gibt es noch so genannte Grid-Based-Filter oder Histogram Filter. Diese teilen den Zustandsraum in so genannte Grids auf in denen ein Wahrscheinlichkeitswert jeweils den Zustand der Region abbildet. Für bestimmte Probleme mit nur zwei Zuständen, kann ein Binary Bayes Filter zum Einsatz kommen. Da in dieser Arbeit ein Partikel Filter verwendet wird, soll seine Funktionsweise kurz erklärt werden.

\subsection{Der Partikel Filter}
\label{subsec:partikelfilter}
\subsubsection*{Zustandsraum}
Der Partikel Filter bildet die Wahrscheinlichkeitsverteilung des vermuteten Zustandes durch eine diskrete Menge von so genannten Partikeln ab. Ein Partikel ist dabei ein Punkt im Zustandsraum zu dem noch ein Gewichtungswert gehört. Angenommen, der Zustand wäre die Position in einem dreidimensionalen Koordinatensystem ist, dann wäre der Zustandsraum alle möglichen Punkte in diesem Koordinatensystem. Ein Partikel in diesem Raum hätte also vier Attribute: einen X-Wert, einen Y-Wert, einen Z-Wert und einen Gewichtungswert. Im Grundzustand, ist der Gewichtungswert bei allen Partikeln gleich und die räumliche Verteilung oder Häufung repräsentiert die Wahrscheinlichkeitsverteilung des vermuteten Zustandes (hier die Position im Koordinatensystem). Häuften sich die Partikel um eine Position, so wäre bei einer zufälligen Ziehung aus den Partikeln, die Wahrscheinlichkeit höher ein Partikel von dieser Position zu ziehen. Mittelt man nun über alle Partikel im Zustandsraum, so erhält man eine Position die dem vermuteten Zustand entspricht. Dabei ist die Varianz über alle Partikel ein Maß dafür, wie zuverlässig diese Position ist.

\subsubsection*{Dynamikmodell}
Partikel Filter nutzen für die Zustandsschätzung ein Dynamikmodell. In diesem Modell wird abgebildet, wie sich der Zustand über die Zeit verändert, z.B. durch Physikalische Gesetzmäßigkeiten oder durch eine Hilfsgröße die sich Messen lässt (z.B. zurück gelegter Weg). Damit erlaubt das Dynamikmodell eine Prognose über den nächsten Zustand abzugeben. Um das Beispiel weiter zu führen stelle man sich vor, man will die Position eines Satelliten der um die Erde kreist bestimmten. Dabei soll lediglich die Position im Raum und nicht seine Orientierung betrachtet werden. Der Zustandsraum besteht damit schon einmal aus X, Y, und Z-Koordinaten. Für das Dynamikmodell könnten hier die Keplerschen Gesetzte zur Bahnberechnung verwendet werden. Allerdings ist es dafür nötig, die Geschwindigkeit des Objektes zu kennen. Dazu wird der Zustandsraum um die Geschwindigkeiten in X, Y und Z-Richtung erweitert. Nun ist es bei einem Gegebenen Zustand möglich einen Folgezustand nach einer verstrichenen Zeit zu errechnen. Leider wird diese Prognose mit der Zeit immer ungenauer, denn in der Realität gibt es immer Störgrößen, die sich nicht vorhersagen lassen. Häufig jedoch lassen sich Aussagen über die Art und Stärke der Störung machen. Dieses Wissen kann in Form von einer Wahrscheinlichkeitsverteilung um die Prognose verwendet werden. Bei dem Satelliten wäre als Störung der Einfluss von Sonnenwind denkbar der ihn von der Sonne weg beschleunigt. Weiß man wie stark der Einfluss werden kann, könnte man ihn als Statistische Größe in die Prognose einfließen lassen. 

\subsubsection*{Messmodell}
Das Messmodell wird benötigt, um entscheiden zu können, wie plausibel eine Messung bei gegebenem Zustand (Im Beispiel die Position) ist. Ein Sensor, über den das System verfügt, liefert einen Messwert. Mit dem Messmodell kann jetzt zu einem Beliebigen Zustand eine Aussage darüber gemacht werden, wie Wahrscheinlich es wäre diesen Messwert zu messen. Im Beispiel des Satelliten könnte der Abstand zu einer Bodenstation gemessen werden. Im Messmodell würde dann aus einem gegebenen Zustand, also Position und Geschwindigkeit, zusammen mit weiteren Informationen wie Position der Bodenstation auf der Erde, Datum und Uhrzeit der Messung errechnet werden wie groß der Abstand sein müsste. Stimmt dieser erwartete Abstand nicht mit dem gemessenen überein, so ist die Messung bei diesem Zustand (Position und Geschwindigkeit) unwahrscheinlich. Zusätzlich ist natürlich jeder Messwert mit einer Ungenauigkeit behaftet, die vom Messprinzip und Sensortyp abhängt. Aber auch diese lässt sich Statistisch angeben und auf den Messwert aufschlagen bevor er ins Messmodell gegeben wird. So lassen sich Zustände im Zustandsraum hervorheben, für die eine gegebene Messung wahrscheinlich sind.

\subsubsection*{Angewendet auf den Filter}
Wenn der Zustandsraum alle möglichen Zustände eines Systems beschreibt, so sind die Partikel des Partikel Filters eine Untermenge davon, die in ihrer räumlichen Häufung den tatsächlichen Zustand des Systems beschreiben. Während des Betriebs gibt es zwei Ereignisse auf die der Filter reagiert:

Das \textbf{Dynamik-Update} berechnet auf Grundlage des Dynamikmodells eine neue Prognose. Konkret wird im Partikel Filter dafür zu jedem Partikel eine eigene Prognose gestellt. Dabei wird eventuelles Systemrauschen durch eine Ziehung pro Partikel aus dessen Wahrscheinlichkeitsverteilung (häufig Gaußverteilung) abgebildet. Die Prognosen aller Partikel bilden dann den neuen Systemzustand.

Der \textbf{Observe} Aufruf verarbeitet eine Messung mit Hilfe des Messmodells. Konkret wird für jedes Partikel, und damit Zustand des es repräsentiert, geprüft wie wahrscheinlich eine solche Messung wäre. Bei einer hohen Wahrscheinlichkeit, wird der Gewichtungswert im Partikel größer. Bei geringer Wahrscheinlichkeit für eine solche Messung sinkt der Gewichtungswert. Nun repräsentieren diese Gewichte der Partikel den neuen Systemzustand.

Das \textbf{Resampling} überführt die Information in den Partikel Gewichten wieder in die Partikel Häufung. Es wird normaler weise nach jedem Observe vorgenommen. Dies geschieht durch Ziehen von Partikeln der alten Partikelmenge mit einer Wahrscheinlichkeit die proportional zum Gewicht eines Partikels ist. Somit werden Partikel die ein hohes Gewicht hatten häufiger gezogen als jede, die nur ein geringes Gewicht hatten. Damit "überleben" das Resampling die Partikel dessen Zustand von einer vorgenommenen Messung bestätigt wird. In ... wird ein Problem beim Resampling beschrieben, welches bei unabhängigen Ziehungen auftritt. Es wird ... genannt und kann dazu führen, das Partikel auch mit hohem Gewicht zufällig gar nicht gezogen werden. Dies würde einen Informationsverlust bedeuten, der im Extremfall den wahren Zustand "vergessen" lässt.

\cite{Thrun:2002:PFR:2073876.2073937} 

\section{Bildverarbeitung}
\label{sec:bildverarbeitung}
Da die von einer Kamera aufgenommenen Bilder in dieser Arbeit eine zentrale Rolle spielen, ist es wichtig zu verstehen, wie diese zustande kommen. Daher soll an dieser Stelle kurz darauf eingegangen werden, wie sich eine Kamera formal beschreiben lässt.
\subsection{Kamera Modell}
Die Lochkamera ist ein sehr einfaches Modell das häufig zur Veranschaulichung verwendet wird. Es soll hier nicht im Detail beschrieben werden, dafür wären ... oder ... zu empfehlen. Doch für das hier vorgestellte Verfahren ist es wichtig das Konzept dahinter zu verstehen:

Die Kamera projiziert im Wesentlichen Punkte aus dem Raum(3D) auf die Bildebene(2D). Um nun bei gegebenen Koordinaten eines 3D-Punktes in Weltkoordinaten den passenden Punkt auf der Bildebene berechnen zu können, ist die Kenntniss verschiedener Parameter erforderlich. Dabei trennt man in extrinsische und intrinsische Parametern. Unter den extrinsichen Kamera Parametern versteht man die Pose der Kamera in Weltkoordinaten. Also wo sich die Kamera befindet, und wie sie ausgerichtet ist. Dies wird in einer Transformationsmatrix ausgedrückt, mit der sich Koordinaten zwischen dem Kamerakoordinatensystem und dem Weltkoordinatensystem  transformieren lassen.

Die intrinsischen Parameter sind nötig, um 3D-Punkte (in Kamerakoordinaten) auf die Bildebene zu projizieren. 

\subsection{Projektion aus dem Raum auf die Bildebene}
\label{subsec:projektion}

